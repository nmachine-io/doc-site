---
sidebar_label: State
---

# State: the Master ConfigMap

When the NMachine client installs an application for a user (e.g creates _an_ NMachine), 
it begins by creating a `ConfigMap` called `master` in the application's
namespace. This is where the application's identity and state are stored. 

## Format

All data is stored in key-value format inside the `data` field of the 
`ConfigMap`. 
Each outermost key holds data for a `space` in the KAMA. If you haven't read up on
[Spaces and Plugins](/concepts/plugins-concept.md) yet, the `space` system 
exists to let a KAMA have mini-KAMAs inside it called Plugins. 

Each value is a big `JSON` string that holds the actual information for that space.

A fresh install's Master ConfigMap without any plugins would look something like the following

```yaml title="<install namespace>/<configmaps>/master"
kind: ConfigMap
metadata:
  name: master
  namespace: xyz
  labels:
    managed_by: nmachine  
data:
  app: '{
    "install_id": "xxx",
    "install_token: "yyy",
    "status": "installing",
    "ktea": {"type": "x", "uri": "y", "version": "z"},
    "kama": {"type": "x", "uri": "y", "version": "z"},
    "default_variables": {"x": "y"},
    "injection_variables": {"y": "z"},	
    "user_variables": {},
    "last_synced": "2021-07-21 14:23:54.731164"
  }'

```

## Contents

The table below gives the purpose of each field in a space entry.

| Key                   | Purpose                                                                                             |
|-----------------------|-----------------------------------------------------------------------------------------------------|
| `install_id`          | UUID for this particular installation, generated by `api.nmachine.io`                               |
| `install_token`       | Authentication token for this particular install against `api.nmachine.io`                          |
| `ktea`                | Definition bundle for the current KTEA, details in complete [KTEA Guide](/concepts/ktea-concept.md) |
| `kama`                | Definition bundle for the current KAMA, details in complete [KAMA Guide](/concepts/kama-concept.md) |
| `status`              | Last computed status for this space: `running`, `broken` or `installing`                            |
| `default_variables`   | Variable assignments pulled from KTEA during installation or last update.                           |
| `injection_variables` | Variable assignments pulled from `api.nmachine.io` during "last mile" sync                          |
| `user_variables`      | Variable assignments made by the user with the NMachine client                                      |
| `last_synced`         | Timestamp of last successful status/telem sync with `api.nmachine.io`                               |


## Access with the KAMA SDK

The KAMA SDK
provides a programmatic interface to deal with it: a singleton instance of 
`ConfigMan`. The instance can be imported and used as follows:

```python
from kama_sdk.core.core.config_man import config_man

print(config_man.install_id())

```

**In most cases however,** you will not need to call the `config_man`
directly; instead, you should use the many specialized `Supplier`, `Action`, and `ManifestVariable`
models to achieve specific things. For instance, if you need to read the `ingress.enabled`
 injection-level manifest variable,
there's a model for that: 
```yaml title="my-models.yaml"
kind: MergedVariablesSupplier
output: ".ingress.enabled"
```





